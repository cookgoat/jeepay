<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <base href="https://api.zihexin.net/topup-merchant/">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="common/css/reset.css" media="screen" title="no title">
    <link rel="stylesheet" href="common/css/invoices.css" media="screen" title="no title">
    <link rel="stylesheet" href="common/css/swiper.min.css" media="screen" title="no title">
    <script src="common/js/flexible.js"></script>
    <script src="common/js/jquery-2.1.3.min.js"></script>
    <script src="common/js/cleave.min.js"></script>
    <script src="common/js/util.js"></script>
    <script src="common/js/vue.min.js"></script>
    <script src="common/js/swiper.min.js"></script>
    <script type="text/javascript">
        window.onload = function(){
            //只有工行app加载
            if ('49b1723939b572e78d9cb49ba0d32119' == "d984307c2629212e00b70faaa1d27c82" || '069e3fd0989084512c453a0247367420' == "d984307c2629212e00b70faaa1d27c82"){
                var script = document.createElement("script");
                script.setAttribute("type","text/javascript");
                script.src = "js/hybrid_app.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            }
        }
    </script>
</head>
<body>
<div id="index_page" class="index-page " :class="getTemplate()" v-cloak>
    <!-- 头部栏 -->
    <div class="title-bar">
        <div class="left-img" id="back" v-show="pageData.haveBack==1 &amp;&amp; window.navigator.userAgent.indexOf('Bankabc/Portal') < 0">
            <img src="img/jt_l.png" alt="">
        </div>
        <div class="title">
            {{ pageData.topic }}
        </div>
        <div class="right-text" id="my">
            我的
        </div>
    </div>
    <!-- 主轮播图 -->
    <div class="swiper-container swiper1" v-if="pageData.ad1_list.length != 0">
        <!-- 轮播内容 -->
        <div class="swiper-wrapper">
            <div class="swiper-slide" v-for="(item,index) in pageData.ad1_list" :key="index" @click="goUrl(item.gourl)">
                <img :src="item.src">
            </div>
        </div>
        <!-- 分页 -->
        <div class="swiper-pagination" v-show="pageData.ad1_list.length != 1"></div>
    </div>
    <div class="shade"></div>
    <div class="shade1" v-if="rechargeHint"></div>
    <div class="recharge-hint" v-if="rechargeHint">
        <div class="recharge-hint-content">
            <div class="hint-title">
                找到“{{brandContent.brand_name}}{{brandContent.account_memo2}}”分{{chineseNum[rechargeData.data.length -1]}}步
            </div>
            <div class="user-name-box">
                <div class="title">
                    您填写的{{brandContent.brand_name}}{{brandContent.account_memo2}}：
                </div>
                <div class="user-name">
                    {{brandContent.userName}}
                </div>
            </div>
            <div class="hint-img">
                <img :src="item" alt="" v-for="(item,index) in rechargeData.data" v-show="index == rechargeImgIndex">
            </div>
            <div class="footer-menu first-menu" v-show="rechargeData.data.length != 1 &amp;&amp; rechargeImgIndex == 0">
                <input type="button" value="下一步" @click="rechargeImgIndex++">
            </div>
            <div class="footer-menu middle-menu" v-show="rechargeImgIndex != (rechargeData.data.length - 1) &amp;&amp; rechargeImgIndex != 0">
                <input type="button" value="上一步" @click="rechargeImgIndex--">
                <input type="button" value="下一步" @click="rechargeImgIndex++">
            </div>
            <div class="footer-menu last-menu" v-show="rechargeImgIndex == (rechargeData.data.length - 1)">
                <div class="back">
                    <input type="button" value="上一步" v-show="rechargeData.data.length>1" @click="rechargeImgIndex--">
                </div>
                <div class="btns">
                    <input type="button" :value="editUserNameBtnText" @click="clickUpdate">
                    <input type="button" value="确认充值" @click="submitOrder(2)">
                </div>
                <div class="caution">
                    发起电子卡券充值服务后，不可撤销、不可退换
                </div>
                <div class="know-prompt">
                    <div class="select-img" @click="knowPrompt =!knowPrompt">
                        <img src="common/img/agreement_checked.png" alt="" v-if="knowPrompt">
                        <img src="common/img/agreement_unchecked.png" alt="" v-else>
                    </div>
                    <div class="text">
                        我已了解如何核对{{brandContent.brand_name}}{{brandContent.account_memo2}}，下次不再提示
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 登录 -->
    <div class="login">
        <div class="login-content">
            <div class="close" id="login_close">
                <img src="common/img/close_solid_gray.png" alt="">
            </div>
            <div class="title">
                <p>请输入手机号登录，</p>
                <p>用于查询订单和开具发票</p>
            </div>
            <div class="item ">
                <input type="number" pattern="[0-9]*" autocomplete="off" placeholder="请输入手机号" class="phone" id="login-phone" oninput="if(value.length>11)value=value.slice(0,11);value=value.replace(/[^\d]/g,'')">
            </div>
            <div class="item ">
                <input type="number" pattern="[0-9]*" autocomplete="off" placeholder="请输入验证码" class="v-code" id="v_code" oninput="if(value.length>6)value=value.slice(0,6);value=value.replace(/[^\d]/g,'')">
                <input type="button" value="获取验证码" class="get-v-code">
            </div>
            <div class="btn">
                <input type="button" value="提交" id="login_btn">
            </div>
        </div>
    </div>
    <!-- 温馨提示 -->
    <div class="prompt">
        <div class="title">
            温馨提示
        </div>
        <div class="prompt-content">
        </div>
        <div class="btn">
            <input type="button" value="确认" class="affirm-btn">
        </div>
    </div>
    <div class="pay-shade" id="shade"></div>
    <div class="pay-loading" id="loading">
        <div class="img">
            <img src="common/img/loading_02.gif" alt="">
        </div>
    </div>
    <!-- 自定义金额提示 -->
    <div class="shade1" v-if="prompt1"></div>
    <div class="prompt1" v-if="prompt1">
        <div class="box">
            <div class="title">
                温馨提示
            </div>
            <p> 单笔充值金额满 <span>{{this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.limit_price/100}}</span>元</p>
            <p class="footer-p"> 可享受优惠活动</p>
        </div>
        <div class="btn" @click="prompt1 =!prompt1">
            我知道了
        </div>
    </div>
    <!-- 内容 -->
    <div class="main-content">
        <!-- 左侧品牌菜单 -->
        <ul class="menu" id="menu">
            <li class="my" id="abc-my"> <img src="common/img/wd.png" alt=""> 我的订单 </li>
            <li v-for="(item,index) in pageData.brand_list" :key="index" :class="item.checked ? 'checked' : ''" @click="toggleBrand(item,index)">
                <div class="logo">
                    <img :src="item.logo" alt="">
                </div>
                <div class="name">
                    {{item.brand_name}}
                </div> </li>
        </ul>
        <!-- 右侧内容 -->
        <div class="content">
            <div class="top-content">
                <!-- 小轮播图 -->
                <div class="swiper-container swiper2" v-if="pageData.ad2_list.length != 0">
                    <!-- 轮播内容 -->
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" v-for="(item,index) in pageData.ad2_list" :key="index" @click="goUrl(item.gourl)">
                            <img :src="item.src">
                        </div>
                    </div>
                    <!-- 分页 -->
                    <div class="swiper-pagination" v-show="pageData.ad2_list.length != 1"></div>
                </div>
                <!-- 用户名 -->
                <div class="title clear">
                    <div class="fl">
                        {{ brandContent.account_memo1 }}
                    </div>
                    <div class="fl issue" @click="issuePage(brandContent)" v-if="brandContent.searchaccount.length > 0">
                        <div class="img"></div>
                    </div>
                </div>
                <!-- 输入框用户名或者手机号 -->
                <div class="name">
                    <input v-show="brandContent.account_type == '2'" type="tel" pattern="[0-9]*" :placeholder="placeholderText" class="user-name phone-user-name" v-model="brandContent.userName" @input="userNameChange(brandContent)" :style="'fontSize:' + brandContent.fontSize" @focus="userNameFocus" @blur="userNameBlur">
                    <textarea v-show="brandContent.account_type == '1'" :placeholder="placeholderText" class="user-name" :class="brandContent.fontSize == '7.2vw' ? 'textarea-line-height' : '' " v-model="brandContent.userName" @input="userNameChange(brandContent)" :style="'fontSize:' + brandContent.fontSize" @focus="userNameFocus" @blur="userNameBlur"></textarea>
                    <!--<input  v-show="brandContent.account_type == '1'"-->
                    <!--type="text"-->
                    <!--:placeholder="brandContent.account_memo2"-->
                    <!--class="user-name"-->
                    <!--:class="brandContent.account_type == '2' ? 'phone-user-name' : ''"-->
                    <!--v-model="brandContent.userName"-->
                    <!--@input="userNameChange(brandContent)"-->
                    <!--:style="'fontSize:' + brandContent.fontSize"-->
                    <!--@focus = "userNameFocus"-->
                    <!--@blur = "userNameBlur"-->
                    <!--&gt;-->
                    <div class="img input-empty" @click="emptyUserName()" v-show="brandContent.userName.length > 0 &amp;&amp; isUserNameFocus"></div>
                    <div class="history icoimg" :style="'maxHeight:' + historyData.maxHeight ">
                        <div class="record" @click="checkedHistory">
                            <p>{{historyData.userName}}</p>
                        </div>
                        <div class="clear-history-btn" @click="clearHistory">
                            清空历史记录
                        </div>
                    </div>
                </div>
                <!-- tab选项卡 -->
                <div class="tab-box">
                    <ul class="select-tab clear" :style="getTabWidth(brandContent.chz_type_list.length)" v-if="brandContent.chz_type_list.length > 1">
                        <li class="fl" :class="item.checked ? 'checked' : ''" v-for="(item,index) in brandContent.chz_type_list" :key="index" @click="selectTab(brandContent.chz_type_list,item,index)"> {{item.chz_type_name}}
                            <div class="tab-img1" v-if="showTabImg(brandContent.chz_type_list.length,index,1)"></div>
                            <div class="tab-img2" v-if="showTabImg(brandContent.chz_type_list.length,index,2)"></div> </li>
                    </ul>
                </div>
                <ul class="fixed-list">
                    <li class="" v-for="(item,index) in brandContent.chz_type_list[tabCheckedIndex].face_price_list" :key="index" :class="[{'checked' :item.checked },{'checked-no-discounts': 0 == calculateDiscounts(item.face_price,item.discount,item.limit_price,item.is_discount)}]" @click="toggleFixedValue(brandContent.chz_type_list[tabCheckedIndex].face_price_list,item,index)">
                        <div class="face-value">
                            {{item.face_price}}元
                        </div>
                        <div class="discounts">
                            优惠{{calculateDiscounts(item.face_price,item.discount,item.limit_price,item.is_discount)}}元
                        </div> </li>
                </ul>
                <div class="custom-value " :class="[
                                        {'select-custom-value' : brandContent.chz_type_list[tabCheckedIndex].custom_value.checked},
                                        {'select-have-discounts': calculateDiscounts(brandContent.chz_type_list[tabCheckedIndex].custom_value.face_price,brandContent.chz_type_list[tabCheckedIndex].custom_value.discount,brandContent.chz_type_list[tabCheckedIndex].custom_value.limit_price,brandContent.chz_type_list[tabCheckedIndex].custom_value.is_discount) != 0 &amp;&amp; brandContent.chz_type_list[tabCheckedIndex].custom_value.checked}
                                    ]" v-if="brandContent.chz_type_list[tabCheckedIndex].custom_value !== null">
                    <div class="custom-content ">
                        <span>自定义面值</span>
                        <input type="number" pattern="[0-9]*" placeholder="请输入1-1000整数" oninput="if(value.length == 1){value=value.replace(/[^1-9]/g,'')}else{value=value.replace(/\D/g,'')};if(value>1000)value=1000;" v-model="brandContent.chz_type_list[tabCheckedIndex].custom_value.face_price" @input="customvalueChange" class="custom-input" :style="brandContent.chz_type_list[tabCheckedIndex].custom_value.face_price == '' ? 'fontSize:4.26666667vw':'fontSize:6.13333333vw' " @focus="customValueFocus" @blur="customValueBlur">
                        <span>元</span>
                    </div>
                    <div class="discounts">
                        优惠{{calculateDiscounts(brandContent.chz_type_list[tabCheckedIndex].custom_value.face_price,brandContent.chz_type_list[tabCheckedIndex].custom_value.discount,brandContent.chz_type_list[tabCheckedIndex].custom_value.limit_price,brandContent.chz_type_list[tabCheckedIndex].custom_value.is_discount)}}元
                    </div>
                </div>
                <div class="agreement clear">
                    <div class="agreement-checkbox  fl " :class="isSelectAgreement ? 'checked' : ''" @click="isSelectAgreement = !isSelectAgreement"></div>
                    <div class="fl agreement-text">
                        本人阅读并同意
                        <span class="agreement-page">《充值服务协议》</span>
                        <span class="secret-page">《隐私政策》</span>
                    </div>
                </div>
                <div class="btn">
                    <input type="button" :value="rechargeBtnValue" :disabled="isSelectAgreement &amp;&amp; brandContent.userName.length > 0 ? false : true" class="recharge-btn disabled" @click="submitOrder(1)">
                </div>
                <div class="notes">
                    <img :src="brandContent.recharge_page_memo" alt="">
                </div>
            </div>
            <!-- logo -->
            <div class="logo" v-if="pageData.foot_logo.length > 0">
                <img :src="item" alt="" v-for="(item,index) in pageData.foot_logo" :key="index">
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var goodsList = {"mode":"A","ad1_list":[],"foot_logo":["http:\/\/api.zihexin.net\/appimages\/top\/zhx.png"],"topic":"\u5361\u5238\u5145\u503C","haveBack":0,"ad2_list":[],"brand_list":[{"account_type":"2","search_title":"\u5E38\u89C1\u95EE\u9898","searchaccount":[{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/062e8afbbdfd4c69b92c8caefc416d9d.png","https:\/\/api.zihexin.net\/appimages\/top\/06d1e96230fb4869b4b6c0f56e5fe0e8.png"],"search_button_name":"\u5982\u4F55\u67E5\u770B\u5145\u503C\u7ED3\u679C"}],"recharge_page_memo":"https:\/\/api.zihexin.net\/appimages\/top\/\u6EF4\u6EF4\u51FA\u884C.png","logo":"https:\/\/api.zihexin.net\/appimages\/top\/dd.png","brand_name":"\u6EF4\u6EF4","account_memo1":"\u8BF7\u586B\u5199\u6EF4\u6EF4\u6CE8\u518C\u624B\u673A\u53F7","account_memo2":"\u624B\u673A\u53F7","brand_id":"10001","chz_type_list":[{"chz_type_name":"\u5FEB\u8F66\u5145\u503C","custom_value":{"face_price":"","goods_name":"\u6EF4\u6EF4\u5FEB\u8F66","discount":"0.97","goods_id":"DIDI_101_0","limit_price":2000,"is_discount":1},"chz_type_id":"10001101","face_price_list":[{"face_price":100,"goods_name":"\u6EF4\u6EF4\u5FEB\u8F66","discount":"0.97","goods_id":"DIDI_101_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u6EF4\u6EF4\u5FEB\u8F66","discount":"0.97","goods_id":"DIDI_101_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u6EF4\u6EF4\u5FEB\u8F66","discount":"0.97","goods_id":"DIDI_101_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u6EF4\u6EF4\u5FEB\u8F66","discount":"0.97","goods_id":"DIDI_101_1000","limit_price":2000,"is_discount":1}]},{"chz_type_name":"\u793C\u6A59\u4E13\u8F66\u5145\u503C","custom_value":{"face_price":"","goods_name":"\u6EF4\u6EF4\u793C\u6A59\u4E13\u8F66","discount":"0.97","goods_id":"DIDI_102_0","limit_price":2000,"is_discount":1},"chz_type_id":"10001102","face_price_list":[{"face_price":100,"goods_name":"\u6EF4\u6EF4\u793C\u6A59\u4E13\u8F66","discount":"0.97","goods_id":"DIDI_102_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u6EF4\u6EF4\u793C\u6A59\u4E13\u8F66","discount":"0.97","goods_id":"DIDI_102_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u6EF4\u6EF4\u793C\u6A59\u4E13\u8F66","discount":"0.97","goods_id":"DIDI_102_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u6EF4\u6EF4\u793C\u6A59\u4E13\u8F66","discount":"0.97","goods_id":"DIDI_102_1000","limit_price":2000,"is_discount":1}]},{"chz_type_name":"\u8C6A\u534E\u8F66\u5145\u503C","custom_value":{"face_price":"","goods_name":"\u6EF4\u6EF4\u8C6A\u8F66","discount":"0.97","goods_id":"DIDI_103_0","limit_price":2000,"is_discount":1},"chz_type_id":"10001103","face_price_list":[{"face_price":100,"goods_name":"\u6EF4\u6EF4\u8C6A\u8F66","discount":"0.97","goods_id":"DIDI_103_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u6EF4\u6EF4\u8C6A\u8F66","discount":"0.97","goods_id":"DIDI_103_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u6EF4\u6EF4\u8C6A\u8F66","discount":"0.97","goods_id":"DIDI_103_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u6EF4\u6EF4\u8C6A\u8F66","discount":"0.97","goods_id":"DIDI_103_1000","limit_price":2000,"is_discount":1}]}]},{"account_type":"1","search_title":"\u5E38\u89C1\u95EE\u9898","searchaccount":[{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/6bbe359507fe4b74969cd644a191335d.png"],"search_button_name":"\u5982\u4F55\u67E5\u627E\u7528\u6237\u540D"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/3712aec149e441c9a54b1f56220ec110.png","https:\/\/api.zihexin.net\/appimages\/top\/ab8b2f945e1c47889ef8f4a5c27b5651.png"],"search_button_name":"\u5982\u4F55\u67E5\u770B\u5145\u503C\u7ED3\u679C"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/bec06ce705b547579c2b154f0d8f8e2b.png","https:\/\/api.zihexin.net\/appimages\/top\/886c33d8317640fd8161d1eac4fdd554.png"],"search_button_name":"\u5982\u4F55\u4F7F\u7528\u7535\u5B50\u5361"}],"recharge_page_memo":"https:\/\/api.zihexin.net\/appimages\/top\/\u4EAC\u4E1C.png","logo":"https:\/\/api.zihexin.net\/appimages\/top\/jd.png","brand_name":"\u4EAC\u4E1C","account_memo1":"\u8BF7\u586B\u5199\u4EAC\u4E1C\u6CE8\u518C\u7528\u6237\u540D","account_memo2":"\u7528\u6237\u540D","brand_id":"10002","chz_type_list":[{"chz_type_name":"\u4EAC\u4E1CE\u5361","custom_value":{"face_price":"","goods_name":"\u4EAC\u4E1CE\u5361","discount":"0.995","goods_id":"JD_101_0","limit_price":2000,"is_discount":1},"chz_type_id":"10002101","face_price_list":[{"face_price":100,"goods_name":"\u4EAC\u4E1CE\u5361","discount":"0.995","goods_id":"JD_101_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u4EAC\u4E1CE\u5361","discount":"0.995","goods_id":"JD_101_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u4EAC\u4E1CE\u5361","discount":"0.995","goods_id":"JD_101_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u4EAC\u4E1CE\u5361","discount":"0.995","goods_id":"JD_101_1000","limit_price":2000,"is_discount":1}]}]},{"account_type":"1","search_title":"\u5E38\u89C1\u95EE\u9898","searchaccount":[{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/5894aa279ef941c8badbab733eb680c5.png"],"search_button_name":"\u5982\u4F55\u67E5\u627E\u7528\u6237\u540D"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/065feb499e2a4eb6bc5321ee32e8e45d.png"],"search_button_name":"\u5982\u4F55\u67E5\u770B\u5145\u503C\u7ED3\u679C"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/a4778fccb12e4a31be611f21fd881aa3.png"],"search_button_name":"\u5982\u4F55\u4F7F\u7528\u7535\u5B50\u5361"}],"recharge_page_memo":"https:\/\/api.zihexin.net\/appimages\/top\/\u5929\u732B.png","logo":"https:\/\/api.zihexin.net\/appimages\/top\/tm.png","brand_name":"\u5929\u732B\u8D85\u5E02","account_memo1":"\u8BF7\u586B\u5199\u5929\u732B\u8D85\u5E02\u6CE8\u518C\u4F1A\u5458\u540D","account_memo2":"\u4F1A\u5458\u540D","brand_id":"10003","chz_type_list":[{"chz_type_name":"\u5929\u732B\u8D85\u5E02","custom_value":null,"chz_type_id":"10003101","face_price_list":[{"face_price":100,"goods_name":"\u5929\u732B\u8D85\u5E02\u4EAB\u6DD8\u5361","discount":"0.98","goods_id":"TM_101_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u5929\u732B\u8D85\u5E02\u4EAB\u6DD8\u5361","discount":"0.98","goods_id":"TM_101_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u5929\u732B\u8D85\u5E02\u4EAB\u6DD8\u5361","discount":"0.98","goods_id":"TM_101_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u5929\u732B\u8D85\u5E02\u4EAB\u6DD8\u5361","discount":"0.98","goods_id":"TM_101_1000","limit_price":2000,"is_discount":1}]}]},{"account_type":"2","search_title":"\u5E38\u89C1\u95EE\u9898","searchaccount":[{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/7334fba9531d48528e19eab8761eadd3.png"],"search_button_name":"\u5982\u4F55\u67E5\u770B\u5145\u503C\u7ED3\u679C"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/3bf9194608c54e5b828d5730ae3e4ce3.png","https:\/\/api.zihexin.net\/appimages\/top\/2f989b6dd3754dabb17262424b2fb333.png"],"search_button_name":"\u5982\u4F55\u4F7F\u7528\u7535\u5B50\u5361"}],"recharge_page_memo":"https:\/\/api.zihexin.net\/appimages\/top\/\u643A\u7A0B.png","logo":"https:\/\/api.zihexin.net\/appimages\/top\/xch.png","brand_name":"\u643A\u7A0B\u4EFB\u6211\u884C","account_memo1":"\u8BF7\u586B\u5199\u643A\u7A0B\u6CE8\u518C\u624B\u673A\u53F7","account_memo2":"\u624B\u673A\u53F7","brand_id":"10004","chz_type_list":[{"chz_type_name":"\u643A\u7A0B\u4EFB\u6211\u884C","custom_value":{"face_price":"","goods_name":"\u643A\u7A0B\u4EFB\u6211\u884C","discount":"0.998","goods_id":"XC_101_0","limit_price":2000,"is_discount":1},"chz_type_id":"10004101","face_price_list":[{"face_price":100,"goods_name":"\u643A\u7A0B\u4EFB\u6211\u884C","discount":"0.998","goods_id":"XC_101_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u643A\u7A0B\u4EFB\u6211\u884C","discount":"0.998","goods_id":"XC_101_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u643A\u7A0B\u4EFB\u6211\u884C","discount":"0.998","goods_id":"XC_101_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u643A\u7A0B\u4EFB\u6211\u884C","discount":"0.998","goods_id":"XC_101_1000","limit_price":2000,"is_discount":1}]}]},{"account_type":"1","search_title":"\u5E38\u89C1\u95EE\u9898","searchaccount":[{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/613b9a6eb86046bb8e07a643dc390846.png"],"search_button_name":"\u5982\u4F55\u67E5\u627E\u7528\u6237\u540D"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/9d09c725a8af4b7f974de37d5ea06fb2.png"],"search_button_name":"\u5982\u4F55\u67E5\u770B\u5145\u503C\u7ED3\u679C"},{"search_img":["https:\/\/api.zihexin.net\/appimages\/top\/3d92bec8e93e45099851b12c44d46ac6.png"],"search_button_name":"\u5982\u4F55\u4F7F\u7528\u7535\u5B50\u5361"}],"recharge_page_memo":"https:\/\/api.zihexin.net\/appimages\/top\/\u76D2\u9A6C.png","logo":"https:\/\/api.zihexin.net\/appimages\/top\/hm.png","brand_name":"\u76D2\u9A6C\u9C9C\u751F","account_memo1":"\u8BF7\u586B\u5199\u76D2\u9A6C\u6CE8\u518C\u4F1A\u5458\u540D","account_memo2":"\u4F1A\u5458\u540D","brand_id":"10005","chz_type_list":[{"chz_type_name":"\u76D2\u9A6C\u793C\u54C1\u5361","custom_value":null,"chz_type_id":"10005101","face_price_list":[{"face_price":100,"goods_name":"\u76D2\u9A6C\u9C9C\u751F\u5361","discount":"0.98","goods_id":"HM_101_100","limit_price":2000,"is_discount":1},{"face_price":200,"goods_name":"\u76D2\u9A6C\u9C9C\u751F\u5361","discount":"0.98","goods_id":"HM_101_200","limit_price":2000,"is_discount":1},{"face_price":500,"goods_name":"\u76D2\u9A6C\u9C9C\u751F\u5361","discount":"0.98","goods_id":"HM_101_500","limit_price":2000,"is_discount":1},{"face_price":1000,"goods_name":"\u76D2\u9A6C\u9C9C\u751F\u5361","discount":"0.98","goods_id":"HM_101_1000","limit_price":2000,"is_discount":1}]}]}]};
    //console.log(goodsList)
    //品牌
    var rechargeProductOld = null;
    //商品id
    var rechargeTypeOld = null;
    //充值金额
    var rechargeAmountOld = null;
    //充值账户
    var rechargeAccountOld = null;
    //是否为自定义面值 1 是 0 否
    var productTypeOld = null;
    //是否选中 充值协议 1是 0否
    var aggrementOld = null;

    console.log(goodsList)
    //品牌
    // var rechargeProductOld = "10001";
    // //商品id
    // var rechargeTypeOld = "10001101";
    // //充值金额
    // var rechargeAmountOld = "100";
    // //充值账户
    // var rechargeAccountOld = "17600685458";
    // //是否为自定义面值 1 是 0 否
    // var productTypeOld ="0";
    // //是否选中 充值协议 1是 0否
    // var aggrementOld = 1;


    var merchantId = "d984307c2629212e00b70faaa1d27c82";

    var openid = '';

    var basePath = '';

    var isLogin = "01";
    /* vue */
    new Vue({
        el: "#index_page",
        data: {
            rechargeHint: false,
            prompt1:false,
            rechargeImgIndex: 0,
            knowPrompt: false,
            rechargeData: {},     //00 显示 01不显示
            chineseNum: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十"],

            isUserNameFocus: false,
            isShowIssue: false,        //找用户名弹窗
            isSelectAgreement: false,    //勾选协议
            pageData: goodsList,

            brandContent: {},
            brandIndex: 0,                       //品牌选中index
            tabCheckedIndex: 0,                  //tab选中index
            fixedValueIndex: 0,                 //固定面值选中index
            discountAmount: 0,                   //优惠之后的金额
            rechargeBtnValue: "立即充值",        //充值按钮显示value
            historyData: {
                maxHeight: "",
                userName: "",
            },
            isSubmitClick: true

        },
        created() {

            //初始化数据
            this.initializeData();
        },
        mounted() {
            var loop1 = false;
            var loop2 = false;

            if (this.pageData.ad1_list.length > 1) {
                loop1 = true;
            }
            ;
            if (this.pageData.ad2_list.length > 1) {
                loop2 = true;
            }

            setSwiper(loop1, loop2)

            if (isLogin == "00") {
                $.toast("登录成功")
            }
        },
        watch: {
            "brandContent.userName": function () {

                if (this.strlen(this.brandContent.userName) > 14) {
                    this.brandContent.fontSize = "4.53333333vw"
                } else {
                    this.brandContent.fontSize = "7.2vw"
                }
                this.brandContent = Object.assign({}, this.brandContent);
                this.pageData.brand_list[this.brandIndex] = Object.assign({}, this.brandContent);
            }
        },
        computed: {
            placeholderText() {
                return "请输入" + this.brandContent.account_memo2;
            },
            editUserNameBtnText() {
                return "修改" + this.brandContent.account_memo2;
            },

        },
        methods: {
            issuePage(brandContent) {
                window.sessionStorage.setItem("brandContent", JSON.stringify(brandContent))
                window.location.href = basePath + "toproblempage";
            },
            //初始化数据
            initializeData() {
                $("title").text(this.pageData.topic);
                for (var i = 0; i < this.pageData.brand_list.length; i++) {
                    if (rechargeProductOld === null) {
                        if (i == 0) {
                            this.pageData.brand_list[i].checked = true;
                            this.brandContent = this.pageData.brand_list[i];
                        } else {
                            this.pageData.brand_list[i].checked = false;
                        }
                    } else {
                        if (this.pageData.brand_list[i].brand_id == rechargeProductOld) {
                            this.pageData.brand_list[i].checked = true;
                            this.brandContent = this.pageData.brand_list[i];
                            this.brandIndex = i;
                        } else {
                            this.pageData.brand_list[i].checked = false;
                        }

                    }


                    this.pageData.brand_list[i].userName = "";
                    this.pageData.brand_list[i].fontSize = "7.2vw";

                    for (var y = 0; y < this.pageData.brand_list[i].chz_type_list.length; y++) {
                        if (y == 0) {
                            this.pageData.brand_list[i].chz_type_list[y].checked = true;
                        } else {
                            this.pageData.brand_list[i].chz_type_list[y].checked = false;
                        }

                        if (this.pageData.brand_list[i].chz_type_list[y].custom_value !== null) {
                            if (this.pageData.brand_list[i].chz_type_list[y].face_price_list.length == 0) {
                                this.pageData.brand_list[i].chz_type_list[y].custom_value.checked = true;
                            } else {
                                this.pageData.brand_list[i].chz_type_list[y].custom_value.checked = false;
                            }

                        }

                        for (var k = 0; k < this.pageData.brand_list[i].chz_type_list[y].face_price_list.length; k++) {
                            if (k == 0) {
                                this.pageData.brand_list[i].chz_type_list[y].face_price_list[k].checked = true;
                            } else {
                                this.pageData.brand_list[i].chz_type_list[y].face_price_list[k].checked = false;
                            }
                        }
                    }

                }

                var selectValueData = {};
                if (rechargeProductOld !== null) {

                    this.brandContent.userName = decodeURIComponent(rechargeAccountOld.toString());
                    if (aggrementOld == 1) {
                        this.isSelectAgreement = true;
                    }

                    for (var y = 0; y < this.brandContent.chz_type_list.length; y++) {
                        if (this.brandContent.chz_type_list[y].chz_type_id == rechargeTypeOld) {
                            this.brandContent.chz_type_list[y].checked = true;
                            this.tabCheckedIndex = y;
                            if (productTypeOld == 1) {
                                //1是自定义 2是固定
                                selectValueData = this.brandContent.chz_type_list[y].custom_value
                                this.brandContent.chz_type_list[y].custom_value.face_price = rechargeAmountOld;
                                this.brandContent.chz_type_list[y].custom_value.checked = true;
                                this.fixedValueIndex = 0;
                                for (var k = 0; k < this.brandContent.chz_type_list[y].face_price_list.length; k++) {
                                    this.brandContent.chz_type_list[y].face_price_list[k].checked = false;
                                }
                            } else {
                                for (var k = 0; k < this.brandContent.chz_type_list[y].face_price_list.length; k++) {
                                    var value = this.brandContent.chz_type_list[y].face_price_list[k].face_price;

                                    if (value == rechargeAmountOld) {
                                        this.brandContent.chz_type_list[y].face_price_list[k].checked = true;
                                        this.fixedValueIndex = k;
                                        selectValueData = this.brandContent.chz_type_list[y].face_price_list[k];
                                    } else {
                                        this.brandContent.chz_type_list[y].face_price_list[k].checked = false;
                                    }
                                }
                            }
                        } else {
                            this.brandContent.chz_type_list[y].checked = false;
                        }

                    }

                } else {
                    if (this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list.length == 0) {
                        selectValueData = this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value;
                    } else {
                        selectValueData = this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[this.fixedValueIndex];
                    }

                }
                //console.log(this.brandContent)
                this.brandContent = Object.assign({}, this.brandContent);
                this.customDiscounts(selectValueData);

                var wxMpUser = null;
                if (wxMpUser){
                    openid = wxMpUser.openid;
                    if (openid == null || openid == ''){
                        basePath = 'common/';
                    }else {
                        basePath = 'wechat/';
                    }
                }else {
                    basePath = 'common/';
                }
                this.getHistory(2);

                if (rechargeProductOld !== null) {
                    if (this.brandContent.account_type == "2") {
                        this.brandContent.userName = this.brandContent.userName.substr(0, 3) + ' ' + this.brandContent.userName.substr(3, 4) + ' ' + this.brandContent.userName.substr(7, 4)
                    }
                }
                //console.log(this.brandContent)
            },
            //设置模式
            getTemplate() {
                //默认蓝色 A 蓝色 B红色
                sessionStorage.setItem("mode", this.pageData.mode);
                sessionStorage.setItem("haveBack", this.pageData.haveBack);
                switch (this.pageData.mode) {
                    case "B":
                        return "index-red";
                        break;
                    case "C":
                        return "index-purple";
                        break;
                    default:
                        return "";
                }
            },
            showIssue(type) {
                if (type == "show") {
                    this.isShowIssue = true;
                    $(".shade").show();
                } else {
                    this.isShowIssue = false;
                    $(".shade").hide();
                }

            },
            //跳转
            goUrl(url) {
                if (url != "" && url != null) {
                    window.location = url;
                }
            },
            //切换左侧菜单
            toggleBrand(item, index) {
//                console.log(item,index,this.pageData)
                for (var i = 0; i < this.pageData.brand_list.length; i++) {
                    this.pageData.brand_list[i].checked = false;
                }
                item.checked = true;
                this.pageData = Object.assign({}, this.pageData);
                this.brandContent = item;
                this.brandIndex = index;

                for (var i = 0; i < this.brandContent.chz_type_list.length; i++) {
                    if (this.brandContent.chz_type_list[i].checked) {
                        this.tabCheckedIndex = i;
                    }
                }

                var selectData = {};
                if (this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value !== null) {
                    if (this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.checked) {
                        selectData = this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value;
                    } else {
                        for (var i = 0; i < this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list.length; i++) {
                            if (this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[i].checked) {
                                selectData = this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[i];
                                this.fixedValueIndex = i;
                            }
                        }
                    }
                } else {
                    for (var i = 0; i < this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list.length; i++) {
                        if (this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[i].checked) {
                            selectData = this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[i];
                            this.fixedValueIndex = i;
                        }
                    }
                }

                this.customDiscounts(selectData)
                this.brandContent = Object.assign({}, this.brandContent);

                this.getHistory(2)
            },
            //清空用户名input
            emptyUserName() {
                console.log(11111)
                this.brandContent.userName = "";
                this.brandContent.fontSize = "7.2vw";
                this.brandContent = Object.assign({}, this.brandContent);
            },
            //用户名改变
            userNameChange(userNameData) {
                //手机号
                if (userNameData.account_type == "2") {
                    userNameData.userName = userNameData.userName.replace(/[^\d\s]/ig, "");
                    if (userNameData.userName.length > 13) {
                        userNameData.userName = userNameData.userName.slice(0, 13)
                    }
                } else {
                    //会员名  最大20字符
                    if (this.getNameLen(userNameData.userName) > 20) {
                        userNameData.userName = this.getByteVal(userNameData.userName, 20);
                    }
                }
                if (this.strlen(userNameData.userName) > 14) {
                    userNameData.fontSize = "4.53333333vw"
                } else {
                    userNameData.fontSize = "7.2vw"
                }
                this.brandContent = Object.assign({}, this.brandContent);
                this.pageData.brand_list[this.brandIndex] = Object.assign({}, this.brandContent);
                console.log(2222, this.brandContent)
            },
            //计算字符个数
            getNameLen(str) {
                return str.replace(/[^\x00-\xff]/g, "**").length;
            },
            //字符串截取
            getByteVal(val, max) {
                var returnValue = '';
                var byteValLen = 0;
                for (var i = 0; i < val.length; i++) {
                    if (val[i].match(/[^\x00-\xff]/ig) != null) byteValLen += 2; else byteValLen += 1;
                    if (byteValLen > max) break;
                    returnValue += val[i];
                }
                return returnValue;
            },
            //用户名获取焦点时
            userNameFocus() {
                //获取数据
                this.getHistory(1)

                // var data = "18712862532";
                // if($('.user-name').hasClass('phone-user-name')){
                //     data = data.substr(0, 3) + ' ' + data.substr(3, 4) + ' ' + data.substr(7, 4)
                // }
                // this.historyData={
                //         maxHeight : "1000px",
                //         userName : data
                //     }
                this.isUserNameFocus = true;

            },
            //用户名失去焦点
            userNameBlur() {
                this.historyData.maxHeight = "0";

                var that = this;
                setTimeout(function () {
                    that.isUserNameFocus = false;
                }, 50)
            },
            //选择历史记录
            checkedHistory() {
                this.brandContent.userName = this.historyData.userName;
                this.brandContent = Object.assign({}, this.brandContent);
            },
            //获取历史
            getHistory(type) {
                var that = this;
                $.ajax({
                    url: basePath + 'getrechargeaccountlog',
                    type: 'post',
                    data: {
                        'merchantId': merchantId,
                        'rechargeProduct': that.brandContent.brand_id
                    },
                    success: function (data) {
                        data = decodeURIComponent(data)
                        if (data != "" && data != null) {
                            if (that.brandContent.account_type == "2") {
                                data = data.substr(0, 3) + ' ' + data.substr(3, 4) + ' ' + data.substr(7, 4)
                            }
                            if (type == 1) {
                                that.historyData = {
                                    maxHeight: "1000px",
                                    userName: data
                                }
                            } else {
                                if (that.brandContent.userName == "") {
                                    that.brandContent.userName = data;
                                }
                            }
                        }
                    }
                })
            },
            //清空历史记录
            clearHistory() {
                var that = this;
                $.ajax({
                    url: basePath + 'clearrechargeaccountlog',
                    type: 'post',
                    data: {
                        'merchantId': merchantId,
                        'rechargeProduct': that.brandContent.brand_id
                    },
                    success: function (data) {
                        if (data == "00") {
                            console.log("清除成功")
                        }
                    }
                })
            },
            //显示tab选择图片
            showTabImg(length, tabIndex, imgIndex) {
                if (length > 1) {
                    if (tabIndex == 0) {
                        if (imgIndex == 1) {
                            return false
                        } else {
                            return true
                        }
                    } else if (tabIndex == length - 1) {
                        if (imgIndex == 1) {
                            return true
                        } else {
                            return false
                        }
                    } else {
                        return true
                    }
                }
            },
            //计算tab长度
            getTabWidth(length) {
                if (length > 3) {
                    var width = length * 24;
                    return "width:" + width + "vw";
                }
            },
            //切换tab
            selectTab(data, item, index) {
                // console.log(data)
                for (var i = 0; i < data.length; i++) {
                    data[i].checked = false;
                }
                item.checked = true;
                this.tabCheckedIndex = index;

                if (item.custom_value !== null && item.custom_value.checked) {
                    this.customDiscounts(item.custom_value)
                } else {
                    for (var i = 0; i < item.face_price_list.length; i++) {
                        if (item.face_price_list[i].checked) {
                            this.fixedValueIndex = i;
                            this.customDiscounts(item.face_price_list[i]);
                        }
                    }
                }

                this.brandContent.chz_type_list = Object.assign([], this.brandContent.chz_type_list);
            },
            toggleFixedValue(fixedList, item, index) {

                for (var i = 0; i < fixedList.length; i++) {
                    fixedList[i].checked = false;
                }
                item.checked = true;
                this.fixedValueIndex = index;
                if (this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value !== null) {
                    this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.checked = false;
                    this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.face_price = "";
                }

                this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list = Object.assign([], this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list);
                this.customDiscounts(item);
            },
            customDiscounts(data) {

                //优惠完价格
                if (data.is_discount == 0) {
                    //没有折扣
                    if (data.face_price == 0 || data.face_price == "") {
                        this.rechargeBtnValue = "立即充值";
                    } else {
                        this.rechargeBtnValue = "¥" + data.face_price + " 立即充值";
                    }
                } else {
                    if ((data.limit_price == 0 || data.face_price >= (data.limit_price / 100)) && data.face_price != "") {
                        this.discountAmount = this.accMul(data.face_price, data.discount);
                        this.discountAmount = this.returnInt(this.discountAmount);
                        this.rechargeBtnValue = "¥" + this.discountAmount + " 立即充值";
                    } else {
                        if (data.face_price == 0 || data.face_price == "") {
                            this.rechargeBtnValue = "立即充值";
                        } else {
                            this.rechargeBtnValue = "¥" + data.face_price + " 立即充值";
                        }
                    }

                }

            },
            /*计算折扣
             * faceValue 面值
             * discount 折扣
             * limitMoney 是否有限制 0就是没限制
             * is_discount 是否参与折扣
             * */
            calculateDiscounts(faceValue, discount, limitMoney, is_discount) {
                var discountMoney = 0;
                if (is_discount == 1 && faceValue != "") {
                    if (faceValue >= (limitMoney / 100) || limitMoney == 0) {
                        discountMoney = this.accSub(faceValue, this.returnInt(this.accMul(faceValue, discount)));
                    }
                }
                return discountMoney;
            },
            //自定义面值更改时
            customvalueChange() {
                //console.log(this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.face_price)
                this.customDiscounts(this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value)

            },
            //自定义框获取焦点
            customValueFocus() {
                for (var i = 0; i < this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list.length; i++) {
                    this.brandContent.chz_type_list[this.tabCheckedIndex].face_price_list[i].checked = false;
                }
                this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value.checked = true;
                this.brandContent.chz_type_list = Object.assign([], this.brandContent.chz_type_list);
                this.customDiscounts(this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value);

            },
            //自定义失去取焦点
            customValueBlur() {

                let data =this.brandContent.chz_type_list[this.tabCheckedIndex].custom_value;
                if ((data.limit_price == 0 || data.face_price >= (data.limit_price / 100)) && data.face_price != "") {

                }else{

                    this.prompt1 = true;
                }

            },
            //提示弹出框中点击修改用户名
            clickUpdate() {
                this.rechargeHint = false;
                this.rechargeImgIndex = 0;
                var that = this;
                //判断是否勾选了不再提示
                console.log("点击修改")
                if (that.knowPrompt) {
                    $.ajax({
                        url: basePath + 'updateusercheckstatus',
                        type: 'post',
                        data: {
                            'merchantId': merchantId,
                            'rechargeProduct': that.brandContent.brand_id,
                            'type': 1
                        },
                        success: function (data) {
                            if (data.resultCode == '00') {
                                console.log("修改成功")
                            } else {
                                console.log("修改失败")
                            }
                        }
                    })
                }
            },
            //提交订单 type 1 立即充值 2 提示中的确认充值
            submitOrder(type) {

                var that = this;
                //验证手机号
                if (that.brandContent.account_type == "2") {

                    if (!that.phoneNumberVerify(that.trims(that.brandContent.userName))) {
                        $.toast("请输入正确手机号！");
                        return
                    }
                } else {
                    //京东
                    if (that.brandContent.brand_id == "10002" && (that.getNameLen(that.brandContent.userName) < 4)) {
                        $.toast("京东用户名不合法！");
                        return
                    } else if (that.brandContent.brand_id == "10003" || that.brandContent.brand_id == "10005") {
                        //淘宝
                        if (that.getNameLen(that.brandContent.userName) < 5) {
                            $.toast("会员名不合法！");
                            return
                        }
                    }
                }


//                console.log(that.brandContent.chz_type_list,that.tabCheckedIndex,that.fixedValueIndex)

                var faceValue = -1;
                var goodsId = "";
                if (that.brandContent.chz_type_list[that.tabCheckedIndex].custom_value !== null) {
                    if (that.brandContent.chz_type_list[that.tabCheckedIndex].custom_value.checked) {
                        faceValue = that.brandContent.chz_type_list[that.tabCheckedIndex].custom_value.face_price;
                        goodsId = that.brandContent.chz_type_list[that.tabCheckedIndex].custom_value.goods_id;
                        if (faceValue == "") {
                            $.toast("请输入自定义面值！");
                            return
                        }
                    } else {
                        faceValue = that.brandContent.chz_type_list[that.tabCheckedIndex].face_price_list[that.fixedValueIndex].face_price;
                        goodsId = that.brandContent.chz_type_list[that.tabCheckedIndex].face_price_list[that.fixedValueIndex].goods_id;
                    }
                } else {
                    faceValue = that.brandContent.chz_type_list[that.tabCheckedIndex].face_price_list[that.fixedValueIndex].face_price;
                    goodsId = that.brandContent.chz_type_list[that.tabCheckedIndex].face_price_list[that.fixedValueIndex].goods_id;
                }


                $(".pay-shade").show();
                $(".pay-loading").show();

                if (openid != null && openid != '') {
                    if (type == 1) {
                        //查看是否用户显示提示
                        console.log("立即充值")

                        $.ajax({
                            url: basePath + 'getuserguide',
                            type: 'post',
                            data: {
                                'merchantId': merchantId,
                                'rechargeProduct': that.brandContent.brand_id,
                                'type': '1'
                            },
                            success: function (data) {
                                if (data.resultCode == '00') {
                                    //显示提示
                                    that.rechargeHint = true;
                                    that.rechargeData = data;
                                    console.log('data', that.rechargeData)
                                    $(".pay-shade").hide();
                                    $(".pay-loading").hide();
                                } else if (data.resultCode == '01') {
                                    //不显示提示
                                    that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                        that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                                }
                            }, complete: function () {
                                $(".pay-shade").hide();
                                $(".pay-loading").hide();
                            }
                        })
                    } else if (type == 2) {
                        //判断是否勾选
                        console.log("确认充值")
                        if (that.knowPrompt) {
                            $.ajax({
                                url: basePath + 'updateusercheckstatus',
                                type: 'post',
                                data: {
                                    'merchantId': merchantId,
                                    'rechargeProduct': that.brandContent.brand_id,
                                    'type': 1
                                },
                                success: function (data) {
                                    if (data.resultCode == '00') {
                                        that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                            that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                                    } else {
                                        $.toast(data.resultMsg, 3000);
                                    }
                                }, complete: function () {
                                    $(".pay-shade").hide();
                                    $(".pay-loading").hide();
                                }
                            })
                        } else {
                            that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                        }


                    }
                } else {
                    //查看是否登录
                    $.ajax({
                        url: basePath + "islogin",
                        type: 'post',
                        data: {'merchantId': merchantId},
                        success: function (data) {
                            if (data.resultCode == '01') {
                                if (data.loginUrl != null && data.loginUrl != "") {
                                    window.location = data.loginUrl;
                                } else {
                                    $(".shade").show();
                                    $(".login").css("left", "50%");
                                }

                                return
                            } else {
                                setTimeout(function () {
                                    $(".pay-shade").show();
                                    $(".pay-loading").show();
                                }, 0)

                                if (type == 1) {
                                    //查看是否用户显示提示
                                    console.log("立即充值")

                                    $.ajax({
                                        url: basePath + 'getuserguide',
                                        type: 'post',
                                        data: {
                                            'merchantId': merchantId,
                                            'rechargeProduct': that.brandContent.brand_id,
                                            'type': '1'
                                        },
                                        success: function (data) {
                                            if (data.resultCode == '00') {
                                                //显示提示
                                                that.rechargeHint = true;
                                                that.rechargeData = data;
                                                console.log('data', that.rechargeData)
                                                $(".pay-shade").hide();
                                                $(".pay-loading").hide();
                                            } else if (data.resultCode == '01') {
                                                //不显示提示
                                                that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                                    that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                                            }
                                        }, complete: function () {
                                            $(".pay-shade").hide();
                                            $(".pay-loading").hide();
                                        }
                                    })
                                } else if (type == 2) {
                                    //判断是否勾选
                                    console.log("确认充值")
                                    if (that.knowPrompt) {
                                        $.ajax({
                                            url: basePath + 'updateusercheckstatus',
                                            type: 'post',
                                            data: {
                                                'merchantId': merchantId,
                                                'rechargeProduct': that.brandContent.brand_id,
                                                'type': 1
                                            },
                                            success: function (data) {
                                                if (data.resultCode == '00') {
                                                    that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                                        that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                                                } else {
                                                    $.toast(data.resultMsg, 3000);
                                                }
                                            }, complete: function () {
                                                $(".pay-shade").hide();
                                                $(".pay-loading").hide();
                                            }
                                        })
                                    } else {
                                        that.createOrder(that.brandContent.brand_id, that.brandContent.userName,
                                            that.brandContent.chz_type_list[that.tabCheckedIndex].chz_type_id, faceValue, goodsId)
                                    }


                                }
                            }
                        },
                        complete: function () {

                            $(".pay-shade").hide();
                            $(".pay-loading").hide();
                        }
                    })
                }

            },
            createOrder(rechargeProduct, rechargeAccount, rechargeType, rechargeAmount, goodsId) {
                setTimeout(function () {
                    $(".pay-shade").show();
                    $(".pay-loading").show();
                }, 0)

                var that = this;
                $.ajax({
                    url: basePath + 'createorder',
                    type: 'post',
                    data: {
                        'merchantId': merchantId,
                        'rechargeProduct': rechargeProduct,
                        'rechargeAccount': this.trims(rechargeAccount),
                        'rechargeType': rechargeType,
                        'rechargeAmount': rechargeAmount,
                        'goodsId': goodsId
                    },
                    success: function (data) {

                        if (data.resultCode == '01') {
                            $(".shade").show();
                            $(".login").css("left", "50%");
                            redicturl = "";
                        } else if (data.resultCode == '00') {
                            //跳转订单支付页
                            that.rechargeHint = false;
                            that.rechargeImgIndex = 0;
                            window.location = basePath + "topayorder?rechargeAccount=" + rechargeAccount + "&payAmount=" +
                                data.payAmount + "&goodsName=" + data.goodsName + "&orderNo=" + data.orderNo + "&merchantId=" + merchantId + "&isPaying=01";
                        } else {
                            $.toast(data.resultMsg, 3000);
                        }
                    },
                    complete: function () {
                        $(".pay-shade").hide();
                        $(".pay-loading").hide();
                    }
                })
            },
            phoneNumberVerify(tel) {
                if (tel != "") {
                    var reg = /^0?1[3|4|5|6|7|8|9][0-9]\d{8}$/;
                    return reg.test(tel);
                }
            },
            //去除空格方法获取的时候有空格用这个方法去空格
            trims(str, is_global) {
                var result;
                result = str.replace(/(^\s+)|(\s+$)/g, "");
                result = result.replace(/\s/g, "");
                return result;
            },
            //保留两位小数
            returnFloat(value) {
                var value = Math.round(parseFloat(value) * 100) / 100;
                var xsd = value.toString().split(".");
                if (xsd.length == 1) {
                    value = value.toString() + ".00";
                    return value;
                }
                if (xsd.length > 1) {
                    if (xsd[1].length < 2) {
                        value = value.toString() + "0";
                    }
                    return value;
                }
            },
            //默认保留两位小数，不四舍五入
            returnInt(num, decimal) {
                decimal = isNaN(decimal) ? 2 : decimal;
                num = num.toString()
                let index = num.indexOf('.')
                if (index !== -1) {
                    num = num.substring(0, decimal + index + 1)
                } else {
                    num = num.substring(0)
                }
                return parseFloat(num).toFixed(decimal)
            },
            //减法
            accSub(arg1, arg2) {
                var r1, r2, m, n;
                try {
                    r1 = arg1.toString().split(".")[1].length
                } catch (e) {
                    r1 = 0
                }
                ;
                try {
                    r2 = arg2.toString().split(".")[1].length
                } catch (e) {
                    r2 = 0
                }
                ;
                m = Math.pow(10, Math.max(r1, r2));
                // 动态控制精度长度
                n = (r1 >= r2) ? r1 : r2;
                return ((arg1 * m - arg2 * m) / m).toFixed(n);
            },
            //乘法
            accMul(arg1, arg2) {
                var m = 0,
                    s1 = arg1.toString(),
                    s2 = arg2.toString();
                try {
                    m += s1.split(".")[1].length
                } catch (e) {
                }
                ;
                try {
                    m += s2.split(".")[1].length
                } catch (e) {
                }
                ;
                return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m);
            },
            strlen(str) {
                var len = 0;
                for (var i = 0; i < str.length; i++) {
                    var c = str.charCodeAt(i);
                    //单字节加1
                    if ((c >= 0x0001 && c <= 0x007e) || (0xff60 <= c && c <= 0xff9f)) {
                        len++;
                    }
                    else {
                        len += 2;
                    }
                }
                return len;
            }

        },

    })

    function setSwiper(loop1, loop2) {
        console.log(121)
        //轮播图

        var mySwiper1 = new Swiper('.swiper1', {
            direction: 'horizontal',
            loop: loop1,
            autoplay: {
                delay: 3000,
            },
            // 分页
            pagination: {
                el: '.swiper-pagination',
            },

        })


        var mySwiper2 = new Swiper('.swiper2', {
            direction: 'horizontal',
            loop: loop2,
            autoplay: {
                delay: 3000,
            },
            // 分页
            pagination: {
                el: '.swiper-pagination',
            },

        })
    }

    var redicturl;
    /* jq */
    $(function () {

        if (window.navigator.userAgent.indexOf('Bankabc/Portal') < 0 && merchantId != '86cb6d35b93a64fa743394ee8f9a330f' && merchantId != 'baff2a015e3e3454d984503d28517abf') {
            $("#abc-my").hide();
        } else {
            $(".title-bar").hide();
            if(window.navigator.userAgent.indexOf('Bankabc/Portal') > 0) {//农行适配
                AlipayJSBridge.call('setOptionMenu', {
                    menus: [{
                        icon: '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', //“关闭” 图标 Base64。 40x40， 周边不留白
                        redDot: '-1', // -1 表示不显示， 0 表示显示红点， 1-99 表示在红点上显示的数字
                    }],
                    override: true // 是否覆盖默认的 optionMenu， 统一传 true
                });
                AlipayJSBridge.call('showOptionMenu');
            }

        }

        document.addEventListener('optionMenu', function (e) {
            if (e.data.index == 0) {
                // 用户点击了第一个图标。 setOptionMenu 方法中， 设置了第一个图标为“关闭”
                AlipayJSBridge.call('abcExitWebAndBackToHome');
            } else if (e.data.index == 1) {
                // 点击了自定义图标
                alert('点击了自定义图标');
            }
        }, false);

        $("input,textarea").on("blur", function () {
            window.scroll(0, 0);
        });
        //轮播图

        // var mySwiper1 = new Swiper ('.swiper1', {
        //     direction: 'horizontal',
        //     loop: true,
        //     autoplay:{
        //         delay: 3000,
        //     },
        //     // 分页
        //     pagination: {
        //     el: '.swiper-pagination',
        //     // clickable:true,        //点击分页跳转到对应的位置
        //     //bulletActiveClass:""    //active  对应的class
        //     },
        //
        // })
        //
        // var mySwiper2 = new Swiper ('.swiper2', {
        //     direction: 'horizontal',
        //     loop: true,
        //     autoplay:{
        //         delay: 3000,
        //     },
        //     // 分页
        //     pagination: {
        //     el: '.swiper-pagination',
        //     // clickable:true,        //点击分页跳转到对应的位置
        //     //bulletActiveClass:""    //active  对应的class
        //     },
        //
        // })

        var cleave = new Cleave('.phone-user-name', {
            blocks: [3, 4, 4],
            uppercase: true
        });


        //返回
        $("#back").on("click", function () {
            if (merchantId == '069e3fd0989084512c453a0247367420') {
                hybrid_app.back();
            }
            else {
                window.history.go(-1);
            }
        });
        //我的
        $("#my,#abc-my").on("click", function () {
            if (openid != null && openid != '') {
                window.location = basePath + "my?merchantId=" + merchantId;
            } else {
                $.ajax({
                    url: basePath + 'islogin',
                    type: 'post',
                    data: {'merchantId': merchantId, 'type': '1'},
                    success: function (data) {
                        //console.log(data.resultCode)
                        if (data.resultCode == '01') {
                            redicturl = basePath + "my?merchantId=" + merchantId;
                            if (data.loginUrl != null && data.loginUrl != "") {
                                window.location = data.loginUrl;
                            } else {
                                $(".shade").show();
                                // $(".login").show();
                                $(".login").css("left", "50%");
                            }
                        } else if (data.resultCode == '00') {
                            window.location = basePath + "my?merchantId=" + merchantId;
                        }
                    }
                })
            }

        });


        //点击登录关闭按钮
        $("#login_close").on("click", function () {
            $(".shade").hide();
            // $(".login").hide();
            $(".login").css("left", "-200%");
            redicturl = "";
        })


        //登录点击获取验证码
        $(".get-v-code").on("click", function () {
            var phone = $("#login-phone").val();
            //验证手机号
            if (phone == "") {
                $.toast("请输入手机号！");
                return
            } else if (!$.PhoneNumberVerify(phone)) {
                $.toast("请输入正确手机号！");
                return
            }
            var btn = $('.get-v-code');
            var num = 60;
            btn.val('' + (--num) + 's');
            btn.attr("disabled", "disabled");
            btn.addClass("get-v-code-disabled");
            var setTime = setInterval(function () {
                btn.val('' + (--num) + 's');
                if (num == 0) {
                    btn.prop('disabled', false);
                    btn.val('获取验证码');
                    btn.removeClass("get-v-code-disabled");
                    clearInterval(setTime);
                }
            }, 1000);
            $.ajax({
                url: basePath + 'sendsmscode',
                type: 'post',
                data: {'phone': phone},
                success: function (data) {
                    if (data.resultCode == "00") {

                    } else {
                        $.toast("短信发送失败");
                    }
                }
            })

        })

        //登录
        $("#login_btn").on("click", function () {
            //验证手机号
            if ($("#login-phone").val() == "") {
                $.toast("请输入手机号！");
                return
            } else if (!$.PhoneNumberVerify($("#login-phone").val())) {
                $.toast("请输入正确手机号！");
                return
            }
            //验证验证码
            if ($("#v_code").val() == "") {
                $.toast("请输入验证码！");
                return
            } else if ($("#v_code").val().length != 6) {
                $.toast("请输入正确验证码！");
                return
            }
            $.ajax({
                url: basePath + 'login',
                type: 'post',
                data: {
                    'merchantId': merchantId,
                    'phone': $("#login-phone").val(),
                    'code': $("#v_code").val(),
                    'redirectUrl': redicturl
                },
                success: function (data) {
                    if (data.resultCode == "00") {
                        $(".shade").hide();
                        // $(".login").hide();
                        $(".login").css("left", "-200%");
                        redicturl = "";
                        $.toast("登录成功")
                        //console.log("============="+data.redirectUrl)
                        if (data.redirectUrl != '' && data.redirectUrl != null) {
                            window.location.href = data.redirectUrl;
                        }
                    } else {
                        $.toast(data.resultMsg)
                    }
                },
                error: function () {
                    $.toast("登录失败")
                }
            })

        })

        //温馨提示确认点击
        $(".affirm-btn").on("click", function () {
            $(".shade").hide();
            $(".prompt").hide();
        })
        //协议页面点击
        $(".agreement-page").on("click", function () {
            //跳转服务协议页面
            window.location = basePath + "toagreement";
        })

        $(".secret-page").on("click", function () {
            //跳转服务协议页面
            window.location = basePath + "tosecret";
        })


    })
</script>
</body>
</html>